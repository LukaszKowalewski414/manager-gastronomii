{% extends 'base.html' %}

{% block content %}
<div class="container my-5">
    <h2 class="text-center mb-4 text-primary">Dodaj rozliczenie dzienne</h2>

    <!-- GŁÓWNY FORMULARZ - zapis rozliczenia -->
    <form method="POST" action="{{ url_for('add_daily') }}">
        <div class="mb-3">
            <label for="data" class="form-label">Data</label>
            <input type="date" id="data" name="data" class="form-control" required>
        </div>

        <h5>Przychody</h5>
        {% for field in ['bar', 'kuchnia', 'wejsciowki', 'inne'] %}
        <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" id="sprzedaz_{{ field }}" name="sprzedaz_{{ field }}"
                   {% if field in config.domyslne_przychody %}checked{% endif %}>
            <label class="form-check-label" for="sprzedaz_{{ field }}">Sprzedaż {{ field }}</label>
            <input type="number" step="0.01" class="form-control mt-1" name="sprzedaz_{{ field }}_kwota" placeholder="Kwota (zł)">
        </div>
        {% endfor %}

        <hr>
        <h5>Koszty</h5>
        {% for field in ['bar', 'kelnerzy', 'kuchnia', 'ochrona'] %}
        <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" id="koszt_{{ field }}" name="koszt_{{ field }}"
                   {% if field in config.domyslne_koszty %}checked{% endif %}>
            <label class="form-check-label" for="koszt_{{ field }}">Obsługa {{ field }}</label>
            <input type="number" step="0.01" class="form-control mt-1" name="koszt_{{ field }}_kwota" placeholder="Kwota (zł)">
        </div>
        {% endfor %}

        <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" id="koszt_marketing" name="koszt_marketing"
                   {% if 'marketing' in config.domyslne_koszty %}checked{% endif %}>
            <label class="form-check-label" for="koszt_marketing">Marketing</label>
            <input type="number" step="0.01" class="form-control mt-1" name="koszt_marketing_kwota" placeholder="Kwota (zł)">
            <input type="text" class="form-control mt-1" name="koszt_marketing_komentarz" placeholder="Komentarz (opcjonalny)">
        </div>

        <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" id="koszt_inne" name="koszt_inne"
                   {% if 'inne' in config.domyslne_koszty %}checked{% endif %}>
            <label class="form-check-label" for="koszt_inne">Inne</label>
            <input type="number" step="0.01" class="form-control mt-1" name="koszt_inne_kwota" placeholder="Kwota (zł)">
            <input type="text" class="form-control mt-1" name="koszt_inne_komentarz" placeholder="Komentarz (opcjonalny)">
        </div>

        <div class="text-center mt-4">
            <button type="submit" class="btn btn-success btn-lg px-5 mb-3">
                 Zapisz rozliczenie dnia
            </button>
        </div>
    </form>

    <!-- FORMULARZ POMOCNICZY - zapis domyślnych checkboxów -->
    <form method="POST" action="{{ url_for('save_defaults') }}">
        {% for field in ['bar', 'kuchnia', 'wejsciowki', 'inne'] %}
            <input type="hidden" name="sprzedaz_{{ field }}" value="1"
                   {% if field in config.domyslne_przychody %}checked{% endif %}
                   id="hidden_sprzedaz_{{ field }}">
        {% endfor %}
        {% for field in ['bar', 'kelnerzy', 'kuchnia', 'ochrona'] %}
            <input type="hidden" name="koszt_{{ field }}" value="1"
                   {% if field in config.domyslne_koszty %}checked{% endif %}
                   id="hidden_koszt_{{ field }}">
        {% endfor %}
        <input type="hidden" name="koszt_marketing" value="1" id="hidden_koszt_marketing"
               {% if 'marketing' in config.domyslne_koszty %}checked{% endif %}>
        <input type="hidden" name="koszt_inne" value="1" id="hidden_koszt_inne"
               {% if 'inne' in config.domyslne_koszty %}checked{% endif %}>

        <div class="text-center">
            <button type="submit" class="btn btn-outline-secondary btn-sm">
                ⚙️ Zapisz obecne ustawienia jako domyślne
            </button>
        </div>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const checkboxes = document.querySelectorAll('.form-check-input');

    checkboxes.forEach(function (checkbox) {
        toggleRelatedFields(checkbox);

        checkbox.addEventListener('change', function () {
            toggleRelatedFields(checkbox);
            const hidden = document.getElementById('hidden_' + checkbox.id);
            if (hidden) {
                hidden.disabled = !checkbox.checked;
            }
        });
    });

    function toggleRelatedFields(checkbox) {
        const container = checkbox.closest('.form-check');
        const inputs = container.querySelectorAll('.form-control');
        inputs.forEach(input => {
            input.style.display = checkbox.checked ? 'block' : 'none';
        });
    }
});
</script>
{% endblock %}
